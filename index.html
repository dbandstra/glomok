<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Glomok</title>
    <style>
      body {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <canvas id="glcanvas" width="1240" height="600">
      Canvas not supported.
    </canvas>
    <script src="gl-matrix-min.js"></script>
    <script src="src/shaders.js"></script>
    <script src="src/tex-board.js"></script>
    <script src="src/tex-pieceshadow.js"></script>
    <script src="src/mesh-piece.js"></script>
    <script src="src/view.js"></script>
    <script src="src/draw-setup.js"></script>
    <script src="src/draw.js"></script>
    <script src="src/gameplay.js"></script>
    <script>
      const boardConfig = {
        numLines: 15,
        imageDim: 2048, // width/height of image
        imageMargin: 128, // number of pixels around the grid
        worldDim: 1, // world diameter of board (including margin)
      };

      let shouldRepaint = false;

      ///////

      window.addEventListener('load', startup, false);

      function startup() {
        const gameState = getInitialGameState();

        const glCanvas = document.getElementById('glcanvas');
        const gl = glCanvas.getContext('webgl');

        const renderState = drawSetup(glCanvas, gl);

        calcViewInfo(gameState, {glCanvas});

        glCanvas.addEventListener('mousemove', (e) => {
          mouseMove(gameState, glCanvas, [e.clientX, e.clientY]);
          maybeRepaint(renderState, gameState);
        });
        glCanvas.addEventListener('mousedown', () => {
          clickEvent(gameState);
          maybeRepaint(renderState, gameState);
        });

        drawScene(renderState, gameState);
      }

      function repaint() {
        shouldRepaint = true;
      }

      function maybeRepaint(renderState, gameState) {
        if (shouldRepaint) {
          shouldRepaint = false;
          window.requestAnimationFrame(() => {
            drawScene(renderState, gameState);
          });
        }
      }
    </script>
  </body>
</html>
