!function(r){var t={};function n(e){if(t[e])return t[e].exports;var a=t[e]={i:e,l:!1,exports:{}};return r[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=r,n.c=t,n.d=function(r,t,e){n.o(r,t)||Object.defineProperty(r,t,{enumerable:!0,get:e})},n.r=function(r){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},n.t=function(r,t){if(1&t&&(r=n(r)),8&t)return r;if(4&t&&"object"==typeof r&&r&&r.__esModule)return r;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:r}),2&t&&"string"!=typeof r)for(var a in r)n.d(e,a,function(t){return r[t]}.bind(null,a));return e},n.n=function(r){var t=r&&r.__esModule?function(){return r.default}:function(){return r};return n.d(t,"a",t),t},n.o=function(r,t){return Object.prototype.hasOwnProperty.call(r,t)},n.p="",n(n.s=6)}({6:function(r,t,n){"use strict";n.r(t);var e={};n.r(e),n.d(e,"create",function(){return f}),n.d(e,"clone",function(){return l}),n.d(e,"copy",function(){return s}),n.d(e,"fromValues",function(){return d}),n.d(e,"set",function(){return h}),n.d(e,"identity",function(){return v}),n.d(e,"transpose",function(){return m}),n.d(e,"invert",function(){return M}),n.d(e,"adjoint",function(){return g}),n.d(e,"determinant",function(){return b}),n.d(e,"multiply",function(){return y}),n.d(e,"translate",function(){return p}),n.d(e,"scale",function(){return w}),n.d(e,"rotate",function(){return x}),n.d(e,"rotateX",function(){return A}),n.d(e,"rotateY",function(){return P}),n.d(e,"rotateZ",function(){return E}),n.d(e,"fromTranslation",function(){return _}),n.d(e,"fromScaling",function(){return T}),n.d(e,"fromRotation",function(){return R}),n.d(e,"fromXRotation",function(){return C}),n.d(e,"fromYRotation",function(){return S}),n.d(e,"fromZRotation",function(){return L}),n.d(e,"fromRotationTranslation",function(){return V}),n.d(e,"fromQuat2",function(){return I}),n.d(e,"getTranslation",function(){return N}),n.d(e,"getScaling",function(){return F}),n.d(e,"getRotation",function(){return B}),n.d(e,"fromRotationTranslationScale",function(){return D}),n.d(e,"fromRotationTranslationScaleOrigin",function(){return k}),n.d(e,"fromQuat",function(){return q}),n.d(e,"frustum",function(){return U}),n.d(e,"perspective",function(){return j}),n.d(e,"perspectiveFromFieldOfView",function(){return O}),n.d(e,"ortho",function(){return G}),n.d(e,"lookAt",function(){return X}),n.d(e,"targetTo",function(){return Y}),n.d(e,"str",function(){return W}),n.d(e,"frob",function(){return H}),n.d(e,"add",function(){return z}),n.d(e,"subtract",function(){return Q}),n.d(e,"multiplyScalar",function(){return Z}),n.d(e,"multiplyScalarAndAdd",function(){return K}),n.d(e,"exactEquals",function(){return J}),n.d(e,"equals",function(){return $}),n.d(e,"mul",function(){return rr}),n.d(e,"sub",function(){return tr});var a={};n.r(a),n.d(a,"create",function(){return nr}),n.d(a,"clone",function(){return er}),n.d(a,"length",function(){return ar}),n.d(a,"fromValues",function(){return or}),n.d(a,"copy",function(){return ir}),n.d(a,"set",function(){return ur}),n.d(a,"add",function(){return cr}),n.d(a,"subtract",function(){return fr}),n.d(a,"multiply",function(){return lr}),n.d(a,"divide",function(){return sr}),n.d(a,"ceil",function(){return dr}),n.d(a,"floor",function(){return hr}),n.d(a,"min",function(){return vr}),n.d(a,"max",function(){return mr}),n.d(a,"round",function(){return Mr}),n.d(a,"scale",function(){return gr}),n.d(a,"scaleAndAdd",function(){return br}),n.d(a,"distance",function(){return yr}),n.d(a,"squaredDistance",function(){return pr}),n.d(a,"squaredLength",function(){return wr}),n.d(a,"negate",function(){return xr}),n.d(a,"inverse",function(){return Ar}),n.d(a,"normalize",function(){return Pr}),n.d(a,"dot",function(){return Er}),n.d(a,"cross",function(){return _r}),n.d(a,"lerp",function(){return Tr}),n.d(a,"hermite",function(){return Rr}),n.d(a,"bezier",function(){return Cr}),n.d(a,"random",function(){return Sr}),n.d(a,"transformMat4",function(){return Lr}),n.d(a,"transformMat3",function(){return Vr}),n.d(a,"transformQuat",function(){return Ir}),n.d(a,"rotateX",function(){return Nr}),n.d(a,"rotateY",function(){return Fr}),n.d(a,"rotateZ",function(){return Br}),n.d(a,"angle",function(){return Dr}),n.d(a,"str",function(){return kr}),n.d(a,"exactEquals",function(){return qr}),n.d(a,"equals",function(){return Ur}),n.d(a,"sub",function(){return jr}),n.d(a,"mul",function(){return Or}),n.d(a,"div",function(){return Gr}),n.d(a,"dist",function(){return Xr}),n.d(a,"sqrDist",function(){return Yr}),n.d(a,"len",function(){return Wr}),n.d(a,"sqrLen",function(){return Hr}),n.d(a,"forEach",function(){return zr});var o={};n.r(o),n.d(o,"create",function(){return Qr}),n.d(o,"clone",function(){return Zr}),n.d(o,"fromValues",function(){return Kr}),n.d(o,"copy",function(){return Jr}),n.d(o,"set",function(){return $r}),n.d(o,"add",function(){return rt}),n.d(o,"subtract",function(){return tt}),n.d(o,"multiply",function(){return nt}),n.d(o,"divide",function(){return et}),n.d(o,"ceil",function(){return at}),n.d(o,"floor",function(){return ot}),n.d(o,"min",function(){return it}),n.d(o,"max",function(){return ut}),n.d(o,"round",function(){return ct}),n.d(o,"scale",function(){return ft}),n.d(o,"scaleAndAdd",function(){return lt}),n.d(o,"distance",function(){return st}),n.d(o,"squaredDistance",function(){return dt}),n.d(o,"length",function(){return ht}),n.d(o,"squaredLength",function(){return vt}),n.d(o,"negate",function(){return mt}),n.d(o,"inverse",function(){return Mt}),n.d(o,"normalize",function(){return gt}),n.d(o,"dot",function(){return bt}),n.d(o,"lerp",function(){return yt}),n.d(o,"random",function(){return pt}),n.d(o,"transformMat4",function(){return wt}),n.d(o,"transformQuat",function(){return xt}),n.d(o,"str",function(){return At}),n.d(o,"exactEquals",function(){return Pt}),n.d(o,"equals",function(){return Et}),n.d(o,"sub",function(){return _t}),n.d(o,"mul",function(){return Tt}),n.d(o,"div",function(){return Rt}),n.d(o,"dist",function(){return Ct}),n.d(o,"sqrDist",function(){return St}),n.d(o,"len",function(){return Lt}),n.d(o,"sqrLen",function(){return Vt}),n.d(o,"forEach",function(){return It});var i=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array,c=Math.random;Math.PI;function f(){var r=new u(16);return u!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function l(r){var t=new u(16);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t}function s(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function d(r,t,n,e,a,o,i,c,f,l,s,d,h,v,m,M){var g=new u(16);return g[0]=r,g[1]=t,g[2]=n,g[3]=e,g[4]=a,g[5]=o,g[6]=i,g[7]=c,g[8]=f,g[9]=l,g[10]=s,g[11]=d,g[12]=h,g[13]=v,g[14]=m,g[15]=M,g}function h(r,t,n,e,a,o,i,u,c,f,l,s,d,h,v,m,M){return r[0]=t,r[1]=n,r[2]=e,r[3]=a,r[4]=o,r[5]=i,r[6]=u,r[7]=c,r[8]=f,r[9]=l,r[10]=s,r[11]=d,r[12]=h,r[13]=v,r[14]=m,r[15]=M,r}function v(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function m(r,t){if(r===t){var n=t[1],e=t[2],a=t[3],o=t[6],i=t[7],u=t[11];r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=n,r[6]=t[9],r[7]=t[13],r[8]=e,r[9]=o,r[11]=t[14],r[12]=a,r[13]=i,r[14]=u}else r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15];return r}function M(r,t){var n=t[0],e=t[1],a=t[2],o=t[3],i=t[4],u=t[5],c=t[6],f=t[7],l=t[8],s=t[9],d=t[10],h=t[11],v=t[12],m=t[13],M=t[14],g=t[15],b=n*u-e*i,y=n*c-a*i,p=n*f-o*i,w=e*c-a*u,x=e*f-o*u,A=a*f-o*c,P=l*m-s*v,E=l*M-d*v,_=l*g-h*v,T=s*M-d*m,R=s*g-h*m,C=d*g-h*M,S=b*C-y*R+p*T+w*_-x*E+A*P;return S?(S=1/S,r[0]=(u*C-c*R+f*T)*S,r[1]=(a*R-e*C-o*T)*S,r[2]=(m*A-M*x+g*w)*S,r[3]=(d*x-s*A-h*w)*S,r[4]=(c*_-i*C-f*E)*S,r[5]=(n*C-a*_+o*E)*S,r[6]=(M*p-v*A-g*y)*S,r[7]=(l*A-d*p+h*y)*S,r[8]=(i*R-u*_+f*P)*S,r[9]=(e*_-n*R-o*P)*S,r[10]=(v*x-m*p+g*b)*S,r[11]=(s*p-l*x-h*b)*S,r[12]=(u*E-i*T-c*P)*S,r[13]=(n*T-e*E+a*P)*S,r[14]=(m*y-v*w-M*b)*S,r[15]=(l*w-s*y+d*b)*S,r):null}function g(r,t){var n=t[0],e=t[1],a=t[2],o=t[3],i=t[4],u=t[5],c=t[6],f=t[7],l=t[8],s=t[9],d=t[10],h=t[11],v=t[12],m=t[13],M=t[14],g=t[15];return r[0]=u*(d*g-h*M)-s*(c*g-f*M)+m*(c*h-f*d),r[1]=-(e*(d*g-h*M)-s*(a*g-o*M)+m*(a*h-o*d)),r[2]=e*(c*g-f*M)-u*(a*g-o*M)+m*(a*f-o*c),r[3]=-(e*(c*h-f*d)-u*(a*h-o*d)+s*(a*f-o*c)),r[4]=-(i*(d*g-h*M)-l*(c*g-f*M)+v*(c*h-f*d)),r[5]=n*(d*g-h*M)-l*(a*g-o*M)+v*(a*h-o*d),r[6]=-(n*(c*g-f*M)-i*(a*g-o*M)+v*(a*f-o*c)),r[7]=n*(c*h-f*d)-i*(a*h-o*d)+l*(a*f-o*c),r[8]=i*(s*g-h*m)-l*(u*g-f*m)+v*(u*h-f*s),r[9]=-(n*(s*g-h*m)-l*(e*g-o*m)+v*(e*h-o*s)),r[10]=n*(u*g-f*m)-i*(e*g-o*m)+v*(e*f-o*u),r[11]=-(n*(u*h-f*s)-i*(e*h-o*s)+l*(e*f-o*u)),r[12]=-(i*(s*M-d*m)-l*(u*M-c*m)+v*(u*d-c*s)),r[13]=n*(s*M-d*m)-l*(e*M-a*m)+v*(e*d-a*s),r[14]=-(n*(u*M-c*m)-i*(e*M-a*m)+v*(e*c-a*u)),r[15]=n*(u*d-c*s)-i*(e*d-a*s)+l*(e*c-a*u),r}function b(r){var t=r[0],n=r[1],e=r[2],a=r[3],o=r[4],i=r[5],u=r[6],c=r[7],f=r[8],l=r[9],s=r[10],d=r[11],h=r[12],v=r[13],m=r[14],M=r[15];return(t*i-n*o)*(s*M-d*m)-(t*u-e*o)*(l*M-d*v)+(t*c-a*o)*(l*m-s*v)+(n*u-e*i)*(f*M-d*h)-(n*c-a*i)*(f*m-s*h)+(e*c-a*u)*(f*v-l*h)}function y(r,t,n){var e=t[0],a=t[1],o=t[2],i=t[3],u=t[4],c=t[5],f=t[6],l=t[7],s=t[8],d=t[9],h=t[10],v=t[11],m=t[12],M=t[13],g=t[14],b=t[15],y=n[0],p=n[1],w=n[2],x=n[3];return r[0]=y*e+p*u+w*s+x*m,r[1]=y*a+p*c+w*d+x*M,r[2]=y*o+p*f+w*h+x*g,r[3]=y*i+p*l+w*v+x*b,y=n[4],p=n[5],w=n[6],x=n[7],r[4]=y*e+p*u+w*s+x*m,r[5]=y*a+p*c+w*d+x*M,r[6]=y*o+p*f+w*h+x*g,r[7]=y*i+p*l+w*v+x*b,y=n[8],p=n[9],w=n[10],x=n[11],r[8]=y*e+p*u+w*s+x*m,r[9]=y*a+p*c+w*d+x*M,r[10]=y*o+p*f+w*h+x*g,r[11]=y*i+p*l+w*v+x*b,y=n[12],p=n[13],w=n[14],x=n[15],r[12]=y*e+p*u+w*s+x*m,r[13]=y*a+p*c+w*d+x*M,r[14]=y*o+p*f+w*h+x*g,r[15]=y*i+p*l+w*v+x*b,r}function p(r,t,n){var e=n[0],a=n[1],o=n[2],i=void 0,u=void 0,c=void 0,f=void 0,l=void 0,s=void 0,d=void 0,h=void 0,v=void 0,m=void 0,M=void 0,g=void 0;return t===r?(r[12]=t[0]*e+t[4]*a+t[8]*o+t[12],r[13]=t[1]*e+t[5]*a+t[9]*o+t[13],r[14]=t[2]*e+t[6]*a+t[10]*o+t[14],r[15]=t[3]*e+t[7]*a+t[11]*o+t[15]):(i=t[0],u=t[1],c=t[2],f=t[3],l=t[4],s=t[5],d=t[6],h=t[7],v=t[8],m=t[9],M=t[10],g=t[11],r[0]=i,r[1]=u,r[2]=c,r[3]=f,r[4]=l,r[5]=s,r[6]=d,r[7]=h,r[8]=v,r[9]=m,r[10]=M,r[11]=g,r[12]=i*e+l*a+v*o+t[12],r[13]=u*e+s*a+m*o+t[13],r[14]=c*e+d*a+M*o+t[14],r[15]=f*e+h*a+g*o+t[15]),r}function w(r,t,n){var e=n[0],a=n[1],o=n[2];return r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e,r[3]=t[3]*e,r[4]=t[4]*a,r[5]=t[5]*a,r[6]=t[6]*a,r[7]=t[7]*a,r[8]=t[8]*o,r[9]=t[9]*o,r[10]=t[10]*o,r[11]=t[11]*o,r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r}function x(r,t,n,e){var a,o,u,c,f,l,s,d,h,v,m,M,g,b,y,p,w,x,A,P,E,_,T,R,C=e[0],S=e[1],L=e[2],V=Math.sqrt(C*C+S*S+L*L);return V<i?null:(C*=V=1/V,S*=V,L*=V,a=Math.sin(n),u=1-(o=Math.cos(n)),c=t[0],f=t[1],l=t[2],s=t[3],d=t[4],h=t[5],v=t[6],m=t[7],M=t[8],g=t[9],b=t[10],y=t[11],p=C*C*u+o,w=S*C*u+L*a,x=L*C*u-S*a,A=C*S*u-L*a,P=S*S*u+o,E=L*S*u+C*a,_=C*L*u+S*a,T=S*L*u-C*a,R=L*L*u+o,r[0]=c*p+d*w+M*x,r[1]=f*p+h*w+g*x,r[2]=l*p+v*w+b*x,r[3]=s*p+m*w+y*x,r[4]=c*A+d*P+M*E,r[5]=f*A+h*P+g*E,r[6]=l*A+v*P+b*E,r[7]=s*A+m*P+y*E,r[8]=c*_+d*T+M*R,r[9]=f*_+h*T+g*R,r[10]=l*_+v*T+b*R,r[11]=s*_+m*T+y*R,t!==r&&(r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r)}function A(r,t,n){var e=Math.sin(n),a=Math.cos(n),o=t[4],i=t[5],u=t[6],c=t[7],f=t[8],l=t[9],s=t[10],d=t[11];return t!==r&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[4]=o*a+f*e,r[5]=i*a+l*e,r[6]=u*a+s*e,r[7]=c*a+d*e,r[8]=f*a-o*e,r[9]=l*a-i*e,r[10]=s*a-u*e,r[11]=d*a-c*e,r}function P(r,t,n){var e=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],u=t[2],c=t[3],f=t[8],l=t[9],s=t[10],d=t[11];return t!==r&&(r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=o*a-f*e,r[1]=i*a-l*e,r[2]=u*a-s*e,r[3]=c*a-d*e,r[8]=o*e+f*a,r[9]=i*e+l*a,r[10]=u*e+s*a,r[11]=c*e+d*a,r}function E(r,t,n){var e=Math.sin(n),a=Math.cos(n),o=t[0],i=t[1],u=t[2],c=t[3],f=t[4],l=t[5],s=t[6],d=t[7];return t!==r&&(r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r[0]=o*a+f*e,r[1]=i*a+l*e,r[2]=u*a+s*e,r[3]=c*a+d*e,r[4]=f*a-o*e,r[5]=l*a-i*e,r[6]=s*a-u*e,r[7]=d*a-c*e,r}function _(r,t){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,r}function T(r,t){return r[0]=t[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=t[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=t[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function R(r,t,n){var e,a,o,u=n[0],c=n[1],f=n[2],l=Math.sqrt(u*u+c*c+f*f);return l<i?null:(u*=l=1/l,c*=l,f*=l,e=Math.sin(t),o=1-(a=Math.cos(t)),r[0]=u*u*o+a,r[1]=c*u*o+f*e,r[2]=f*u*o-c*e,r[3]=0,r[4]=u*c*o-f*e,r[5]=c*c*o+a,r[6]=f*c*o+u*e,r[7]=0,r[8]=u*f*o+c*e,r[9]=c*f*o-u*e,r[10]=f*f*o+a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function C(r,t){var n=Math.sin(t),e=Math.cos(t);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e,r[6]=n,r[7]=0,r[8]=0,r[9]=-n,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function S(r,t){var n=Math.sin(t),e=Math.cos(t);return r[0]=e,r[1]=0,r[2]=-n,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=n,r[9]=0,r[10]=e,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function L(r,t){var n=Math.sin(t),e=Math.cos(t);return r[0]=e,r[1]=n,r[2]=0,r[3]=0,r[4]=-n,r[5]=e,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function V(r,t,n){var e=t[0],a=t[1],o=t[2],i=t[3],u=e+e,c=a+a,f=o+o,l=e*u,s=e*c,d=e*f,h=a*c,v=a*f,m=o*f,M=i*u,g=i*c,b=i*f;return r[0]=1-(h+m),r[1]=s+b,r[2]=d-g,r[3]=0,r[4]=s-b,r[5]=1-(l+m),r[6]=v+M,r[7]=0,r[8]=d+g,r[9]=v-M,r[10]=1-(l+h),r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function I(r,t){var n=new u(3),e=-t[0],a=-t[1],o=-t[2],i=t[3],c=t[4],f=t[5],l=t[6],s=t[7],d=e*e+a*a+o*o+i*i;return d>0?(n[0]=2*(c*i+s*e+f*o-l*a)/d,n[1]=2*(f*i+s*a+l*e-c*o)/d,n[2]=2*(l*i+s*o+c*a-f*e)/d):(n[0]=2*(c*i+s*e+f*o-l*a),n[1]=2*(f*i+s*a+l*e-c*o),n[2]=2*(l*i+s*o+c*a-f*e)),V(r,t,n),r}function N(r,t){return r[0]=t[12],r[1]=t[13],r[2]=t[14],r}function F(r,t){var n=t[0],e=t[1],a=t[2],o=t[4],i=t[5],u=t[6],c=t[8],f=t[9],l=t[10];return r[0]=Math.sqrt(n*n+e*e+a*a),r[1]=Math.sqrt(o*o+i*i+u*u),r[2]=Math.sqrt(c*c+f*f+l*l),r}function B(r,t){var n=t[0]+t[5]+t[10],e=0;return n>0?(e=2*Math.sqrt(n+1),r[3]=.25*e,r[0]=(t[6]-t[9])/e,r[1]=(t[8]-t[2])/e,r[2]=(t[1]-t[4])/e):t[0]>t[5]&&t[0]>t[10]?(e=2*Math.sqrt(1+t[0]-t[5]-t[10]),r[3]=(t[6]-t[9])/e,r[0]=.25*e,r[1]=(t[1]+t[4])/e,r[2]=(t[8]+t[2])/e):t[5]>t[10]?(e=2*Math.sqrt(1+t[5]-t[0]-t[10]),r[3]=(t[8]-t[2])/e,r[0]=(t[1]+t[4])/e,r[1]=.25*e,r[2]=(t[6]+t[9])/e):(e=2*Math.sqrt(1+t[10]-t[0]-t[5]),r[3]=(t[1]-t[4])/e,r[0]=(t[8]+t[2])/e,r[1]=(t[6]+t[9])/e,r[2]=.25*e),r}function D(r,t,n,e){var a=t[0],o=t[1],i=t[2],u=t[3],c=a+a,f=o+o,l=i+i,s=a*c,d=a*f,h=a*l,v=o*f,m=o*l,M=i*l,g=u*c,b=u*f,y=u*l,p=e[0],w=e[1],x=e[2];return r[0]=(1-(v+M))*p,r[1]=(d+y)*p,r[2]=(h-b)*p,r[3]=0,r[4]=(d-y)*w,r[5]=(1-(s+M))*w,r[6]=(m+g)*w,r[7]=0,r[8]=(h+b)*x,r[9]=(m-g)*x,r[10]=(1-(s+v))*x,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function k(r,t,n,e,a){var o=t[0],i=t[1],u=t[2],c=t[3],f=o+o,l=i+i,s=u+u,d=o*f,h=o*l,v=o*s,m=i*l,M=i*s,g=u*s,b=c*f,y=c*l,p=c*s,w=e[0],x=e[1],A=e[2],P=a[0],E=a[1],_=a[2],T=(1-(m+g))*w,R=(h+p)*w,C=(v-y)*w,S=(h-p)*x,L=(1-(d+g))*x,V=(M+b)*x,I=(v+y)*A,N=(M-b)*A,F=(1-(d+m))*A;return r[0]=T,r[1]=R,r[2]=C,r[3]=0,r[4]=S,r[5]=L,r[6]=V,r[7]=0,r[8]=I,r[9]=N,r[10]=F,r[11]=0,r[12]=n[0]+P-(T*P+S*E+I*_),r[13]=n[1]+E-(R*P+L*E+N*_),r[14]=n[2]+_-(C*P+V*E+F*_),r[15]=1,r}function q(r,t){var n=t[0],e=t[1],a=t[2],o=t[3],i=n+n,u=e+e,c=a+a,f=n*i,l=e*i,s=e*u,d=a*i,h=a*u,v=a*c,m=o*i,M=o*u,g=o*c;return r[0]=1-s-v,r[1]=l+g,r[2]=d-M,r[3]=0,r[4]=l-g,r[5]=1-f-v,r[6]=h+m,r[7]=0,r[8]=d+M,r[9]=h-m,r[10]=1-f-s,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function U(r,t,n,e,a,o,i){var u=1/(n-t),c=1/(a-e),f=1/(o-i);return r[0]=2*o*u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*o*c,r[6]=0,r[7]=0,r[8]=(n+t)*u,r[9]=(a+e)*c,r[10]=(i+o)*f,r[11]=-1,r[12]=0,r[13]=0,r[14]=i*o*2*f,r[15]=0,r}function j(r,t,n,e,a){var o=1/Math.tan(t/2),i=void 0;return r[0]=o/n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=o,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,null!=a&&a!==1/0?(i=1/(e-a),r[10]=(a+e)*i,r[14]=2*a*e*i):(r[10]=-1,r[14]=-2*e),r}function O(r,t,n,e){var a=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),i=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),c=2/(i+u),f=2/(a+o);return r[0]=c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=f,r[6]=0,r[7]=0,r[8]=-(i-u)*c*.5,r[9]=(a-o)*f*.5,r[10]=e/(n-e),r[11]=-1,r[12]=0,r[13]=0,r[14]=e*n/(n-e),r[15]=0,r}function G(r,t,n,e,a,o,i){var u=1/(t-n),c=1/(e-a),f=1/(o-i);return r[0]=-2*u,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*c,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*f,r[11]=0,r[12]=(t+n)*u,r[13]=(a+e)*c,r[14]=(i+o)*f,r[15]=1,r}function X(r,t,n,e){var a=void 0,o=void 0,u=void 0,c=void 0,f=void 0,l=void 0,s=void 0,d=void 0,h=void 0,m=void 0,M=t[0],g=t[1],b=t[2],y=e[0],p=e[1],w=e[2],x=n[0],A=n[1],P=n[2];return Math.abs(M-x)<i&&Math.abs(g-A)<i&&Math.abs(b-P)<i?v(r):(s=M-x,d=g-A,h=b-P,a=p*(h*=m=1/Math.sqrt(s*s+d*d+h*h))-w*(d*=m),o=w*(s*=m)-y*h,u=y*d-p*s,(m=Math.sqrt(a*a+o*o+u*u))?(a*=m=1/m,o*=m,u*=m):(a=0,o=0,u=0),c=d*u-h*o,f=h*a-s*u,l=s*o-d*a,(m=Math.sqrt(c*c+f*f+l*l))?(c*=m=1/m,f*=m,l*=m):(c=0,f=0,l=0),r[0]=a,r[1]=c,r[2]=s,r[3]=0,r[4]=o,r[5]=f,r[6]=d,r[7]=0,r[8]=u,r[9]=l,r[10]=h,r[11]=0,r[12]=-(a*M+o*g+u*b),r[13]=-(c*M+f*g+l*b),r[14]=-(s*M+d*g+h*b),r[15]=1,r)}function Y(r,t,n,e){var a=t[0],o=t[1],i=t[2],u=e[0],c=e[1],f=e[2],l=a-n[0],s=o-n[1],d=i-n[2],h=l*l+s*s+d*d;h>0&&(l*=h=1/Math.sqrt(h),s*=h,d*=h);var v=c*d-f*s,m=f*l-u*d,M=u*s-c*l;return(h=v*v+m*m+M*M)>0&&(v*=h=1/Math.sqrt(h),m*=h,M*=h),r[0]=v,r[1]=m,r[2]=M,r[3]=0,r[4]=s*M-d*m,r[5]=d*v-l*M,r[6]=l*m-s*v,r[7]=0,r[8]=l,r[9]=s,r[10]=d,r[11]=0,r[12]=a,r[13]=o,r[14]=i,r[15]=1,r}function W(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function H(r){return Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)+Math.pow(r[2],2)+Math.pow(r[3],2)+Math.pow(r[4],2)+Math.pow(r[5],2)+Math.pow(r[6],2)+Math.pow(r[7],2)+Math.pow(r[8],2)+Math.pow(r[9],2)+Math.pow(r[10],2)+Math.pow(r[11],2)+Math.pow(r[12],2)+Math.pow(r[13],2)+Math.pow(r[14],2)+Math.pow(r[15],2))}function z(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r[3]=t[3]+n[3],r[4]=t[4]+n[4],r[5]=t[5]+n[5],r[6]=t[6]+n[6],r[7]=t[7]+n[7],r[8]=t[8]+n[8],r[9]=t[9]+n[9],r[10]=t[10]+n[10],r[11]=t[11]+n[11],r[12]=t[12]+n[12],r[13]=t[13]+n[13],r[14]=t[14]+n[14],r[15]=t[15]+n[15],r}function Q(r,t,n){return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r[3]=t[3]-n[3],r[4]=t[4]-n[4],r[5]=t[5]-n[5],r[6]=t[6]-n[6],r[7]=t[7]-n[7],r[8]=t[8]-n[8],r[9]=t[9]-n[9],r[10]=t[10]-n[10],r[11]=t[11]-n[11],r[12]=t[12]-n[12],r[13]=t[13]-n[13],r[14]=t[14]-n[14],r[15]=t[15]-n[15],r}function Z(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r[4]=t[4]*n,r[5]=t[5]*n,r[6]=t[6]*n,r[7]=t[7]*n,r[8]=t[8]*n,r[9]=t[9]*n,r[10]=t[10]*n,r[11]=t[11]*n,r[12]=t[12]*n,r[13]=t[13]*n,r[14]=t[14]*n,r[15]=t[15]*n,r}function K(r,t,n,e){return r[0]=t[0]+n[0]*e,r[1]=t[1]+n[1]*e,r[2]=t[2]+n[2]*e,r[3]=t[3]+n[3]*e,r[4]=t[4]+n[4]*e,r[5]=t[5]+n[5]*e,r[6]=t[6]+n[6]*e,r[7]=t[7]+n[7]*e,r[8]=t[8]+n[8]*e,r[9]=t[9]+n[9]*e,r[10]=t[10]+n[10]*e,r[11]=t[11]+n[11]*e,r[12]=t[12]+n[12]*e,r[13]=t[13]+n[13]*e,r[14]=t[14]+n[14]*e,r[15]=t[15]+n[15]*e,r}function J(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]&&r[4]===t[4]&&r[5]===t[5]&&r[6]===t[6]&&r[7]===t[7]&&r[8]===t[8]&&r[9]===t[9]&&r[10]===t[10]&&r[11]===t[11]&&r[12]===t[12]&&r[13]===t[13]&&r[14]===t[14]&&r[15]===t[15]}function $(r,t){var n=r[0],e=r[1],a=r[2],o=r[3],u=r[4],c=r[5],f=r[6],l=r[7],s=r[8],d=r[9],h=r[10],v=r[11],m=r[12],M=r[13],g=r[14],b=r[15],y=t[0],p=t[1],w=t[2],x=t[3],A=t[4],P=t[5],E=t[6],_=t[7],T=t[8],R=t[9],C=t[10],S=t[11],L=t[12],V=t[13],I=t[14],N=t[15];return Math.abs(n-y)<=i*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(e-p)<=i*Math.max(1,Math.abs(e),Math.abs(p))&&Math.abs(a-w)<=i*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(o-x)<=i*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(u-A)<=i*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(c-P)<=i*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(f-E)<=i*Math.max(1,Math.abs(f),Math.abs(E))&&Math.abs(l-_)<=i*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(s-T)<=i*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(d-R)<=i*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(h-C)<=i*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(v-S)<=i*Math.max(1,Math.abs(v),Math.abs(S))&&Math.abs(m-L)<=i*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(M-V)<=i*Math.max(1,Math.abs(M),Math.abs(V))&&Math.abs(g-I)<=i*Math.max(1,Math.abs(g),Math.abs(I))&&Math.abs(b-N)<=i*Math.max(1,Math.abs(b),Math.abs(N))}var rr=y,tr=Q;function nr(){var r=new u(3);return u!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function er(r){var t=new u(3);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t}function ar(r){var t=r[0],n=r[1],e=r[2];return Math.sqrt(t*t+n*n+e*e)}function or(r,t,n){var e=new u(3);return e[0]=r,e[1]=t,e[2]=n,e}function ir(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r}function ur(r,t,n,e){return r[0]=t,r[1]=n,r[2]=e,r}function cr(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r}function fr(r,t,n){return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r}function lr(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r}function sr(r,t,n){return r[0]=t[0]/n[0],r[1]=t[1]/n[1],r[2]=t[2]/n[2],r}function dr(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r}function hr(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r}function vr(r,t,n){return r[0]=Math.min(t[0],n[0]),r[1]=Math.min(t[1],n[1]),r[2]=Math.min(t[2],n[2]),r}function mr(r,t,n){return r[0]=Math.max(t[0],n[0]),r[1]=Math.max(t[1],n[1]),r[2]=Math.max(t[2],n[2]),r}function Mr(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r}function gr(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r}function br(r,t,n,e){return r[0]=t[0]+n[0]*e,r[1]=t[1]+n[1]*e,r[2]=t[2]+n[2]*e,r}function yr(r,t){var n=t[0]-r[0],e=t[1]-r[1],a=t[2]-r[2];return Math.sqrt(n*n+e*e+a*a)}function pr(r,t){var n=t[0]-r[0],e=t[1]-r[1],a=t[2]-r[2];return n*n+e*e+a*a}function wr(r){var t=r[0],n=r[1],e=r[2];return t*t+n*n+e*e}function xr(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r}function Ar(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r}function Pr(r,t){var n=t[0],e=t[1],a=t[2],o=n*n+e*e+a*a;return o>0&&(o=1/Math.sqrt(o),r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o),r}function Er(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]}function _r(r,t,n){var e=t[0],a=t[1],o=t[2],i=n[0],u=n[1],c=n[2];return r[0]=a*c-o*u,r[1]=o*i-e*c,r[2]=e*u-a*i,r}function Tr(r,t,n,e){var a=t[0],o=t[1],i=t[2];return r[0]=a+e*(n[0]-a),r[1]=o+e*(n[1]-o),r[2]=i+e*(n[2]-i),r}function Rr(r,t,n,e,a,o){var i=o*o,u=i*(2*o-3)+1,c=i*(o-2)+o,f=i*(o-1),l=i*(3-2*o);return r[0]=t[0]*u+n[0]*c+e[0]*f+a[0]*l,r[1]=t[1]*u+n[1]*c+e[1]*f+a[1]*l,r[2]=t[2]*u+n[2]*c+e[2]*f+a[2]*l,r}function Cr(r,t,n,e,a,o){var i=1-o,u=i*i,c=o*o,f=u*i,l=3*o*u,s=3*c*i,d=c*o;return r[0]=t[0]*f+n[0]*l+e[0]*s+a[0]*d,r[1]=t[1]*f+n[1]*l+e[1]*s+a[1]*d,r[2]=t[2]*f+n[2]*l+e[2]*s+a[2]*d,r}function Sr(r,t){t=t||1;var n=2*c()*Math.PI,e=2*c()-1,a=Math.sqrt(1-e*e)*t;return r[0]=Math.cos(n)*a,r[1]=Math.sin(n)*a,r[2]=e*t,r}function Lr(r,t,n){var e=t[0],a=t[1],o=t[2],i=n[3]*e+n[7]*a+n[11]*o+n[15];return i=i||1,r[0]=(n[0]*e+n[4]*a+n[8]*o+n[12])/i,r[1]=(n[1]*e+n[5]*a+n[9]*o+n[13])/i,r[2]=(n[2]*e+n[6]*a+n[10]*o+n[14])/i,r}function Vr(r,t,n){var e=t[0],a=t[1],o=t[2];return r[0]=e*n[0]+a*n[3]+o*n[6],r[1]=e*n[1]+a*n[4]+o*n[7],r[2]=e*n[2]+a*n[5]+o*n[8],r}function Ir(r,t,n){var e=n[0],a=n[1],o=n[2],i=n[3],u=t[0],c=t[1],f=t[2],l=a*f-o*c,s=o*u-e*f,d=e*c-a*u,h=a*d-o*s,v=o*l-e*d,m=e*s-a*l,M=2*i;return l*=M,s*=M,d*=M,h*=2,v*=2,m*=2,r[0]=u+l+h,r[1]=c+s+v,r[2]=f+d+m,r}function Nr(r,t,n,e){var a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0],o[1]=a[1]*Math.cos(e)-a[2]*Math.sin(e),o[2]=a[1]*Math.sin(e)+a[2]*Math.cos(e),r[0]=o[0]+n[0],r[1]=o[1]+n[1],r[2]=o[2]+n[2],r}function Fr(r,t,n,e){var a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[2]*Math.sin(e)+a[0]*Math.cos(e),o[1]=a[1],o[2]=a[2]*Math.cos(e)-a[0]*Math.sin(e),r[0]=o[0]+n[0],r[1]=o[1]+n[1],r[2]=o[2]+n[2],r}function Br(r,t,n,e){var a=[],o=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],o[0]=a[0]*Math.cos(e)-a[1]*Math.sin(e),o[1]=a[0]*Math.sin(e)+a[1]*Math.cos(e),o[2]=a[2],r[0]=o[0]+n[0],r[1]=o[1]+n[1],r[2]=o[2]+n[2],r}function Dr(r,t){var n=or(r[0],r[1],r[2]),e=or(t[0],t[1],t[2]);Pr(n,n),Pr(e,e);var a=Er(n,e);return a>1?0:a<-1?Math.PI:Math.acos(a)}function kr(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"}function qr(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function Ur(r,t){var n=r[0],e=r[1],a=r[2],o=t[0],u=t[1],c=t[2];return Math.abs(n-o)<=i*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(e-u)<=i*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(a-c)<=i*Math.max(1,Math.abs(a),Math.abs(c))}var jr=fr,Or=lr,Gr=sr,Xr=yr,Yr=pr,Wr=ar,Hr=wr,zr=function(){var r=nr();return function(t,n,e,a,o,i){var u=void 0,c=void 0;for(n||(n=3),e||(e=0),c=a?Math.min(a*n+e,t.length):t.length,u=e;u<c;u+=n)r[0]=t[u],r[1]=t[u+1],r[2]=t[u+2],o(r,r,i),t[u]=r[0],t[u+1]=r[1],t[u+2]=r[2];return t}}();function Qr(){var r=new u(4);return u!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Zr(r){var t=new u(4);return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function Kr(r,t,n,e){var a=new u(4);return a[0]=r,a[1]=t,a[2]=n,a[3]=e,a}function Jr(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function $r(r,t,n,e,a){return r[0]=t,r[1]=n,r[2]=e,r[3]=a,r}function rt(r,t,n){return r[0]=t[0]+n[0],r[1]=t[1]+n[1],r[2]=t[2]+n[2],r[3]=t[3]+n[3],r}function tt(r,t,n){return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],r[3]=t[3]-n[3],r}function nt(r,t,n){return r[0]=t[0]*n[0],r[1]=t[1]*n[1],r[2]=t[2]*n[2],r[3]=t[3]*n[3],r}function et(r,t,n){return r[0]=t[0]/n[0],r[1]=t[1]/n[1],r[2]=t[2]/n[2],r[3]=t[3]/n[3],r}function at(r,t){return r[0]=Math.ceil(t[0]),r[1]=Math.ceil(t[1]),r[2]=Math.ceil(t[2]),r[3]=Math.ceil(t[3]),r}function ot(r,t){return r[0]=Math.floor(t[0]),r[1]=Math.floor(t[1]),r[2]=Math.floor(t[2]),r[3]=Math.floor(t[3]),r}function it(r,t,n){return r[0]=Math.min(t[0],n[0]),r[1]=Math.min(t[1],n[1]),r[2]=Math.min(t[2],n[2]),r[3]=Math.min(t[3],n[3]),r}function ut(r,t,n){return r[0]=Math.max(t[0],n[0]),r[1]=Math.max(t[1],n[1]),r[2]=Math.max(t[2],n[2]),r[3]=Math.max(t[3],n[3]),r}function ct(r,t){return r[0]=Math.round(t[0]),r[1]=Math.round(t[1]),r[2]=Math.round(t[2]),r[3]=Math.round(t[3]),r}function ft(r,t,n){return r[0]=t[0]*n,r[1]=t[1]*n,r[2]=t[2]*n,r[3]=t[3]*n,r}function lt(r,t,n,e){return r[0]=t[0]+n[0]*e,r[1]=t[1]+n[1]*e,r[2]=t[2]+n[2]*e,r[3]=t[3]+n[3]*e,r}function st(r,t){var n=t[0]-r[0],e=t[1]-r[1],a=t[2]-r[2],o=t[3]-r[3];return Math.sqrt(n*n+e*e+a*a+o*o)}function dt(r,t){var n=t[0]-r[0],e=t[1]-r[1],a=t[2]-r[2],o=t[3]-r[3];return n*n+e*e+a*a+o*o}function ht(r){var t=r[0],n=r[1],e=r[2],a=r[3];return Math.sqrt(t*t+n*n+e*e+a*a)}function vt(r){var t=r[0],n=r[1],e=r[2],a=r[3];return t*t+n*n+e*e+a*a}function mt(r,t){return r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=-t[3],r}function Mt(r,t){return r[0]=1/t[0],r[1]=1/t[1],r[2]=1/t[2],r[3]=1/t[3],r}function gt(r,t){var n=t[0],e=t[1],a=t[2],o=t[3],i=n*n+e*e+a*a+o*o;return i>0&&(i=1/Math.sqrt(i),r[0]=n*i,r[1]=e*i,r[2]=a*i,r[3]=o*i),r}function bt(r,t){return r[0]*t[0]+r[1]*t[1]+r[2]*t[2]+r[3]*t[3]}function yt(r,t,n,e){var a=t[0],o=t[1],i=t[2],u=t[3];return r[0]=a+e*(n[0]-a),r[1]=o+e*(n[1]-o),r[2]=i+e*(n[2]-i),r[3]=u+e*(n[3]-u),r}function pt(r,t){var n,e,a,o,i,u;t=t||1;do{i=(n=2*c()-1)*n+(e=2*c()-1)*e}while(i>=1);do{u=(a=2*c()-1)*a+(o=2*c()-1)*o}while(u>=1);var f=Math.sqrt((1-i)/u);return r[0]=t*n,r[1]=t*e,r[2]=t*a*f,r[3]=t*o*f,r}function wt(r,t,n){var e=t[0],a=t[1],o=t[2],i=t[3];return r[0]=n[0]*e+n[4]*a+n[8]*o+n[12]*i,r[1]=n[1]*e+n[5]*a+n[9]*o+n[13]*i,r[2]=n[2]*e+n[6]*a+n[10]*o+n[14]*i,r[3]=n[3]*e+n[7]*a+n[11]*o+n[15]*i,r}function xt(r,t,n){var e=t[0],a=t[1],o=t[2],i=n[0],u=n[1],c=n[2],f=n[3],l=f*e+u*o-c*a,s=f*a+c*e-i*o,d=f*o+i*a-u*e,h=-i*e-u*a-c*o;return r[0]=l*f+h*-i+s*-c-d*-u,r[1]=s*f+h*-u+d*-i-l*-c,r[2]=d*f+h*-c+l*-u-s*-i,r[3]=t[3],r}function At(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"}function Pt(r,t){return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]&&r[3]===t[3]}function Et(r,t){var n=r[0],e=r[1],a=r[2],o=r[3],u=t[0],c=t[1],f=t[2],l=t[3];return Math.abs(n-u)<=i*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(e-c)<=i*Math.max(1,Math.abs(e),Math.abs(c))&&Math.abs(a-f)<=i*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-l)<=i*Math.max(1,Math.abs(o),Math.abs(l))}var _t=tt,Tt=nt,Rt=et,Ct=st,St=dt,Lt=ht,Vt=vt,It=function(){var r=Qr();return function(t,n,e,a,o,i){var u=void 0,c=void 0;for(n||(n=4),e||(e=0),c=a?Math.min(a*n+e,t.length):t.length,u=e;u<c;u+=n)r[0]=t[u],r[1]=t[u+1],r[2]=t[u+2],r[3]=t[u+3],o(r,r,i),t[u]=r[0],t[u+1]=r[1],t[u+2]=r[2],t[u+3]=r[3];return t}}();function Nt(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=r[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);e=!0);}catch(r){a=!0,o=r}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ft(r,t){var n=r.viewmtx,i=r.proj,u=Nt(t,2),c=u[0],f=u[1],l=a.create();e.getTranslation(l,n);var s=o.fromValues(2*c-1,2*(1-f)-1,-1,1),d=e.create();e.invert(d,i);var h=o.create();o.transformMat4(h,s,d),h[2]=-1,h[3]=0;var v=o.create();o.transformMat4(v,h,n);var m=a.fromValues(v[0],v[1],v[2]);a.normalize(m,m);return function(r,t,n,e){var o=a.dot(n,t),i=(e-a.dot(n,r))/o,u=a.create();return a.scale(u,t,i),a.add(u,u,r),u}(l,m,a.fromValues(0,0,1),0)}function Bt(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=r[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);e=!0);}catch(r){a=!0,o=r}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var Dt=a.fromValues(-.5,-.5,1),kt=a.fromValues(0,2,1);function qt(r,t){var n=r.proj,i=r.viewmtx,u=r.invviewmtx,c=e.create();e.multiply(c,u,t);var f=e.create();e.multiply(f,n,c);var l=e.create();e.invert(l,t);var s=a.create();e.getTranslation(s,i),a.transformMat4(s,s,l);var d=function(r){var t=a.create();a.normalize(t,r);var n=o.fromValues(t[0],t[1],t[2],0);return o.transformMat4(n,n,l),a.fromValues(n[0],n[1],n[2])};return{modelViewProjection:f,eyePos:s,lightNormal0:d(Dt),lightNormal1:d(kt)}}function Ut(r,t,n){var e=r.gl,a=r.boardShader,o=r.board,i=t.modelViewProjection,u=n.texture,c=n.colour;e.useProgram(a.program),e.bindTexture(e.TEXTURE_2D,u),e.uniform1i(a.uniforms.uTex,0),e.uniform4fv(a.uniforms.uColour,c),e.uniformMatrix4fv(a.uniforms.uModelViewProjection,!1,i),e.bindBuffer(e.ARRAY_BUFFER,o.vertexBuffer),e.enableVertexAttribArray(a.attributes.aVertexPosition),e.vertexAttribPointer(a.attributes.aVertexPosition,o.vertexNumComponents,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,o.texCoordBuffer),e.enableVertexAttribArray(a.attributes.aTexCoord),e.vertexAttribPointer(a.attributes.aTexCoord,2,e.FLOAT,!1,0,0),e.drawArrays(e.TRIANGLES,0,o.vertexCount)}function jt(r,t,n){var e=n.isGlowing;Ut(r,t,{texture:r.tex_pieceshadow,colour:e?o.fromValues(1,0,0,1):o.fromValues(0,0,0,1)})}function Ot(r,t,n){var e=n.colour,a=n.alpha,i=r.gl,u=r.pieceShader,c=r.sphere,f=t.modelViewProjection,l=t.eyePos,s=t.lightNormal0,d=t.lightNormal1;i.useProgram(u.program),i.uniformMatrix4fv(u.uniforms.uModelViewProjection,!1,f),i.uniform4fv(u.uniforms.uGlobalColor,o.fromValues(e[0],e[1],e[2],a)),i.uniform3fv(u.uniforms.uLightNormal0,s),i.uniform3fv(u.uniforms.uLightNormal1,d),i.uniform3fv(u.uniforms.uEyePosition,l),i.bindBuffer(i.ARRAY_BUFFER,c.vertexBuffer),i.enableVertexAttribArray(u.attributes.aVertexPosition),i.vertexAttribPointer(u.attributes.aVertexPosition,c.vertexNumComponents,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,c.normalBuffer),i.enableVertexAttribArray(u.attributes.aVertexNormal),i.vertexAttribPointer(u.attributes.aVertexNormal,c.vertexNumComponents,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,c.elementBuffer),i.drawElements(i.TRIANGLES,3*c.numTriangles,i.UNSIGNED_SHORT,0)}function Gt(r,t,n){var i=r.gl,u=r.glCanvas,c=t.viewInfo;i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.enable(i.CULL_FACE),i.frontFace(i.CW),i.colorMask(!0,!0,!0,!0),i.viewport(0,0,u.width,u.height),i.clearColor(1,1,1,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.colorMask(!0,!0,!0,!1);var f=function(r,t,o){var i=Bt(function(r,t,n){var e=r.imageMargin/r.imageDim,a=-.5*r.worldDim+e,o=.5*r.worldDim-e;return[a+(o-a)*t/(r.numLines-1),a+(o-a)*n/(r.numLines-1)]}(n,r,t),2),u=i[0],c=i[1],f=e.create();return e.translate(f,f,a.fromValues(u,c,o)),f},l={white:[.95,.95,.95],black:[.2,.2,.2]};i.enable(i.DEPTH_TEST),function(r,t){Ut(r,t,{texture:r.tex_board,colour:o.fromValues(1,1,1,1)})}(r,qt(c,e.create())),i.disable(i.DEPTH_TEST);for(var s=0;s<n.numLines;s++)for(var d=0;d<n.numLines;d++){var h=t.getGridState(d,s);if(null!==h){var v=f(d,s,0);if(h.isGlowing){e.scale(v,v,a.fromValues(.12,.12,.12))}else{e.scale(v,v,a.fromValues(.093,.093,.093))}jt(r,qt(c,v),{isGlowing:h.isGlowing})}}i.enable(i.DEPTH_TEST);for(var m=0;m<n.numLines;m++)for(var M=0;M<n.numLines;M++){var g=t.getGridState(M,m);if(null!==g)Ot(r,qt(c,f(M,m,.005)),{colour:l[g.colour],alpha:1})}null!==t.nextPieceColour&&null!==t.mouse_gridPos&&Ot(r,qt(c,f(t.mouse_gridPos[0],t.mouse_gridPos[1],.005)),{colour:l[t.nextPieceColour],alpha:.3})}function Xt(r){return function(r){if(Array.isArray(r)){for(var t=0,n=new Array(r.length);t<r.length;t++)n[t]=r[t];return n}}(r)||function(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var Yt="\nattribute vec3 aVertexPosition;\nattribute vec2 aTexCoord;\n\nuniform mat4 uModelViewProjection;\n\nvarying vec3 vPosition;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  gl_Position = uModelViewProjection * vec4(aVertexPosition, 1.0);\n  vPosition = aVertexPosition;\n  vTexCoord = aTexCoord;\n}\n",Wt="\n#ifdef GL_ES\n  precision highp float;\n#endif\n\nuniform sampler2D uTex;\nuniform vec4 uColour;\n\nvarying vec3 vPosition;\nvarying vec2 vTexCoord;\n\nvoid main() {\n  vec4 colour = texture2D(uTex, vTexCoord) * uColour;\n\n  // this vignette effect was intended for the board, but it gets applied to\n  // pieceshadows too... oh well, they still look fine\n  float f = 1.0 - min(1.0, length(vPosition) / 2.5);\n\n  gl_FragColor.rgb = colour.rgb * f;\n  gl_FragColor.a = colour.a;\n}\n",Ht="\nattribute vec3 aVertexPosition;\nattribute vec3 aVertexNormal;\n\nuniform mat4 uModelViewProjection;\n\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nvoid main() {\n  gl_Position = uModelViewProjection * vec4(aVertexPosition, 1.0);\n  vNormal = aVertexNormal;\n  vPosition = aVertexPosition;\n}\n",zt="\n#ifdef GL_ES\n  precision highp float;\n#endif\n\nuniform vec4 uGlobalColor;\nuniform vec3 uLightNormal0;\nuniform vec3 uLightNormal1;\nuniform vec3 uEyePosition;\n\nvarying vec3 vNormal;\nvarying vec3 vPosition;\n\nvoid main() {\n  vec3 normal = normalize(vNormal);\n\n  float diffuse = dot(uLightNormal0, normal);\n  diffuse = diffuse * 0.7 + 0.3;\n  diffuse = max(0.0, diffuse) * 0.5 + 0.5;\n\n  vec3 reflectedLightNormal0 = 2.0 * normal * dot(normal, uLightNormal0) - uLightNormal0;\n  vec3 reflectedLightNormal1 = 2.0 * normal * dot(normal, uLightNormal1) - uLightNormal1;\n\n  vec3 eyeNormal = normalize(uEyePosition - vPosition);\n\n  float d;\n\n  d = max(0.0, dot(eyeNormal, reflectedLightNormal0));\n  vec3 spec0 = vec3(0.5, 0.5, 0.45) * pow(d, 32.0);\n\n  d = max(0.0, dot(eyeNormal, reflectedLightNormal1));\n  vec3 spec1 = vec3(0.3) * pow(d, 32.0);\n\n  vec4 colour = uGlobalColor;\n  gl_FragColor = vec4(colour.rgb * diffuse + spec0 + spec1, colour.a);\n}\n";function Qt(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=r[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);e=!0);}catch(r){a=!0,o=r}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Zt(r){for(var t=r.imageDim,n=r.imageDim,e=r.imageMargin,a=3,o=0,i=r.numLines,u=new Uint8Array(t*n*3),c=0;c<t*n;c++)u[3*c+0]=238,u[3*c+1]=209,u[3*c+2]=165;for(var f=0;f<t;f++){for(var l=0;l<1;l++)for(var s=0;s<3;s++)u[3*(l*t+f)+s]=0;for(var d=n-1;d<n;d++)for(var h=0;h<3;h++)u[3*(d*t+f)+h]=0}for(var v=0;v<n;v++){for(var m=0;m<1;m++)for(var M=0;M<3;M++)u[3*(v*t+m)+M]=0;for(var g=t-1;g<t;g++)for(var b=0;b<3;b++)u[3*(v*t+g)+b]=0}for(var y=0;y<i;y++)for(var p=e+Math.round(y*(n-2*e)/(i-1)),w=Math.max(p-0,0),x=Math.min(p+0,n-1),A=w;A<=x;A++)for(var P=e;P<t-e;P++){var E=A*t+P;u[3*E+0]=0,u[3*E+1]=0,u[3*E+2]=0}for(var _=0;_<i;_++)for(var T=e+Math.round(_*(t-2*e)/(i-1)),R=Math.max(T-0,0),C=Math.min(T+0,t-1),S=R;S<=C;S++)for(var L=e;L<n-e;L++){var V=L*t+S;u[3*V+0]=0,u[3*V+1]=0,u[3*V+2]=0}return[[7,7],[3,3],[3,11],[11,3],[11,11]].forEach(function(r){var c=Qt(r,2),f=c[0],l=c[1];!function(r,n){for(var e=a+o,i=-e;i<=e;i++)for(var c=-e;c<=e;c++){var f=(n+i)*t+(r+c),l=Math.sqrt(c*c+i*i)-Math.sqrt(a*a);if(l<-o)u[3*f+0]=0,u[3*f+1]=0,u[3*f+2]=0;else if(l<o){var s=(l+o)/(2*o);u[3*f+0]=Math.floor(u[3*f+0]*s+.5),u[3*f+1]=Math.floor(u[3*f+1]*s+.5),u[3*f+2]=Math.floor(u[3*f+2]*s+.5)}}}(Math.round(e+(t-2*e)*f/(i-1)),Math.round(e+(n-2*e)*l/(i-1)))}),{w:t,h:n,pixels:u,fmt:"rgb"}}function Kt(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=r[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);e=!0);}catch(r){a=!0,o=r}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Jt(r,t,n){return t in r?Object.defineProperty(r,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):r[t]=n,r}function $t(r,t,n){return{glCanvas:r,gl:t,boardShader:rn(t,{vertex:Yt,fragment:Wt,uniforms:["uTex","uColour","uModelViewProjection"],attributes:["aVertexPosition","aTexCoord"]}),pieceShader:rn(t,{vertex:Ht,fragment:zt,uniforms:["uGlobalColor","uLightNormal0","uLightNormal1","uEyePosition","uModelViewProjection"],attributes:["aVertexPosition","aVertexNormal"]}),tex_board:tn(t,Zt(n)),tex_pieceshadow:tn(t,function(){for(var r=new Uint8Array(16384),t=0;t<64;t++)for(var n=function(n){var e=n/63*2-1,a=t/63*2-1,o=Math.sqrt(e*e+a*a),i=Math.max(0,1-o);i<0&&(i=0),i>1&&(i=1),i=function(){var r=i*i*i;return(7+(r-7)*i)*r}();var u=64*t+n;r[4*u+0]=255,r[4*u+1]=255,r[4*u+2]=255,r[4*u+3]=Math.floor(255*i+.5)},e=0;e<64;e++)n(e);return{w:64,h:64,pixels:r,fmt:"rgba"}}()),board:nn(t,{vertexArray:new Float32Array([-.5,.5,0,.5,.5,0,.5,-.5,0,-.5,.5,0,.5,-.5,0,-.5,-.5,0]),texCoordArray:new Float32Array([0,1,1,1,1,0,0,1,1,0,0,0])}),sphere:nn(t,function(){var r=new Float32Array(1350),t=0;r[3*t+0]=0,r[3*t+1]=0,r[3*t+2]=-.01,t++;for(var n=1;n<15;n++)for(var e=2*n/15-1,o=.03*Math.sqrt(1-e*e),i=0;i<32;i++){var u=i/32*2*Math.PI,c=Math.cos(u),f=Math.sin(u);r[3*t+0]=c*o,r[3*t+1]=f*o,r[3*t+2]=.01*e,t++}r[3*t+0]=0,r[3*t+1]=0,r[3*t+2]=.01,450!=++t&&console.error("bug in sphere mesh vertices generation");var l=new Uint16Array(2688);t=0;for(var s=0;s<32;s++)l[3*t+0]=0,l[3*t+1]=1+s,l[3*t+2]=1+(s+1)%32,t++;for(var d=0;d<13;d++)for(var h=1+32*d,v=1+32*(d+1),m=0;m<32;m++)l[3*t+0]=h+m,l[3*t+1]=v+m,l[3*t+2]=v+(m+1)%32,l[3*++t+0]=h+m,l[3*t+1]=v+(m+1)%32,l[3*t+2]=h+(m+1)%32,t++;for(var M=0;M<32;M++)l[3*t+0]=417+M,l[3*t+1]=449,l[3*t+2]=417+(M+1)%32,t++;896!==t&&console.error("bug in sphere mesh indices generation");var g=new Float32Array(1350),b=function(){var n=l[3*t+0],e=l[3*t+1],o=l[3*t+2],i=a.fromValues.apply(a,Xt([0,1,2].map(function(t){return r[3*n+t]}))),u=a.fromValues.apply(a,Xt([0,1,2].map(function(t){return r[3*e+t]}))),c=a.fromValues.apply(a,Xt([0,1,2].map(function(t){return r[3*o+t]}))),f=a.create();a.sub(f,c,i);var s=a.create();a.sub(s,u,i);var d=a.create();a.cross(d,f,s),g[3*n+0]+=d[0],g[3*n+1]+=d[1],g[3*n+2]+=d[2],g[3*e+0]+=d[0],g[3*e+1]+=d[1],g[3*e+2]+=d[2],g[3*o+0]+=d[0],g[3*o+1]+=d[1],g[3*o+2]+=d[2]};for(t=0;t<896;t++)b();for(t=0;t<450;t++){var y=a.fromValues.apply(a,Xt([0,1,2].map(function(r){return g[3*t+r]})));a.normalize(y,y),g[3*t+0]=y[0],g[3*t+1]=y[1],g[3*t+2]=y[2]}return{vertexArray:r,normalArray:g,elementArray:l}}())}}function rn(r,t){for(var n=t.vertex,e=t.fragment,a=t.uniforms,o=t.attributes,i=r.createProgram(),u=[[r.VERTEX_SHADER,n],[r.FRAGMENT_SHADER,e]],c=0;c<u.length;c++){var f=Kt(u[c],2),l=f[0],s=f[1],d=r.createShader(l);if(r.shaderSource(d,s),r.compileShader(d),!r.getShaderParameter(d,r.COMPILE_STATUS))throw console.log("Error compiling ".concat(l===r.VERTEX_SHADER?"vertex":"fragment"," shader:")),console.log(r.getShaderInfoLog(d)),new Error("shader compilation failed");r.attachShader(i,d)}if(r.linkProgram(i),!r.getProgramParameter(i,r.LINK_STATUS))throw console.log("Error linking shader program:"),console.log(r.getProgramInfoLog(i)),new Error("shader link failed");return{program:i,uniforms:a.reduce(function(t,n){return Object.assign(t,Jt({},n,r.getUniformLocation(i,n)))},{}),attributes:o.reduce(function(t,n){return Object.assign(t,Jt({},n,r.getAttribLocation(i,n)))},{})}}function tn(r,t){var n=t.w,e=t.h,a=t.pixels,o=t.fmt,i=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),u=function(){switch(o){case"rgb":return r.RGB;case"rgba":return r.RGBA;default:throw new Error("uploadTexture: bad fmt:",o)}}(),c=r.createTexture();if(r.bindTexture(r.TEXTURE_2D,c),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,i?r.LINEAR_MIPMAP_LINEAR:r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texImage2D(r.TEXTURE_2D,0,u,n,e,0,u,r.UNSIGNED_BYTE,a),i){r.generateMipmap(r.TEXTURE_2D);var f=r.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT);r.texParameterf(r.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,f)}return c}function nn(r,t){var n=t.vertexArray,e=t.normalArray,a=t.texCoordArray,o=t.elementArray,i=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,i),r.bufferData(r.ARRAY_BUFFER,n,r.STATIC_DRAW);var u=e&&r.createBuffer()||null;null!==u&&(r.bindBuffer(r.ARRAY_BUFFER,u),r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW));var c=a&&r.createBuffer()||null;null!==c&&(r.bindBuffer(r.ARRAY_BUFFER,c),r.bufferData(r.ARRAY_BUFFER,a,r.STATIC_DRAW));var f=o&&r.createBuffer()||null;return null!==f&&(r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f),r.bufferData(r.ELEMENT_ARRAY_BUFFER,o,r.STATIC_DRAW)),{vertexBuffer:i,vertexNumComponents:3,vertexCount:n.length/3,normalBuffer:u,texCoordBuffer:c,elementBuffer:f,numTriangles:o?o.length/3:0}}function en(r){return function(r){if(Array.isArray(r)){for(var t=0,n=new Array(r.length);t<r.length;t++)n[t]=r[t];return n}}(r)||function(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function an(r,t){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=[],e=!0,a=!1,o=void 0;try{for(var i,u=r[Symbol.iterator]();!(e=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);e=!0);}catch(r){a=!0,o=r}finally{try{e||null==u.return||u.return()}finally{if(a)throw o}}return n}(r,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function on(r,t){for(var n=0;n<t.length;n++){var e=t[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}var un=function(){function r(t){var n=t.cameraAngle,e=t.glCanvas,a=t.boardConfig;!function(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.viewInfo=this._calcViewInfo({cameraAngle:n,glCanvas:e}),this.mousePos=[0,0],this.mouse_gridPos=null,this.nextPieceColour="black",this.status="new-game",this.boardConfig=a,this.gridState=new Array(a.numLines*a.numLines);for(var o=0;o<this.gridState.length;o++)this.gridState[o]=null}return function(r,t,n){t&&on(r.prototype,t),n&&on(r,n)}(r,[{key:"_calcViewInfo",value:function(r){var t=r.cameraAngle,n=function(r){var t=r.glCanvas,n=45*Math.PI/180,a=.01*Math.tan(n/2),o=a*t.width/t.height,i=-a,u=-o,c=e.create();return c[0]=.02/(o-u),c[4]=0,c[8]=(o+u)/(o-u),c[12]=0,c[1]=0,c[5]=.02/(a-i),c[9]=(a+i)/(a-i),c[13]=0,c[2]=0,c[6]=0,c[10]=-1000.01/999.99,c[14]=-20/999.99,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,c}({glCanvas:r.glCanvas}),o=e.create();"default"===t?(e.translate(o,o,a.fromValues(0,-.57,1.1)),e.rotate(o,o,25*Math.PI/180,a.fromValues(1,0,0))):"straight-down"===t?e.translate(o,o,a.fromValues(0,.03,1.3)):(e.translate(o,o,a.fromValues(0,-.85,.4)),e.rotate(o,o,60*Math.PI/180,a.fromValues(1,0,0)));var i=e.create();return e.invert(i,o),{proj:n,viewmtx:o,invviewmtx:i}}},{key:"getGameStatus",value:function(){return this.status}},{key:"getGridState",value:function(r,t){return this.gridState[t*this.boardConfig.numLines+r]||null}},{key:"update",value:function(r){for(var t=arguments.length,n=new Array(t>1?t-1:0),e=1;e<t;e++)n[e-1]=arguments[e];switch(r){case"onMouseMove":return this._onMouseMove.apply(this,n);case"onClick":return this._onClick.apply(this,n);case"setCameraAngle":return this._setCameraAngle.apply(this,n);default:return[]}}},{key:"_setCameraAngle",value:function(r){var t=r.cameraAngle,n=r.glCanvas;return this.viewInfo=this._calcViewInfo({cameraAngle:t,glCanvas:n}),[["repaint"]]}},{key:"_setGridState",value:function(r,t,n){this.gridState[t*this.boardConfig.numLines+r]=n}},{key:"_onMouseMove",value:function(r,t){var n=an(t,2),e=n[0],a=n[1],o=this.mouse_gridPos;return this.mousePos=[e,a],this.mouse_gridPos=function(r,t,n){var e=r.imageMargin/r.imageDim,a=-.5*r.worldDim+e,o=.5*r.worldDim-e,i=Math.round((r.numLines-1)*(t-a)/(o-a)),u=Math.round((r.numLines-1)*(n-a)/(o-a));return i>=0&&u>=0&&i<r.numLines&&u<r.numLines?[i,u]:null}.apply(void 0,[this.boardConfig].concat(en(Ft(this.viewInfo,[this.mousePos[0]/(r.width-1),this.mousePos[1]/(r.height-1)])))),(o&&o[0])!==(this.mouse_gridPos&&this.mouse_gridPos[0])||(o&&o[1])!==(this.mouse_gridPos&&this.mouse_gridPos[1])?[["repaint"]]:[]}},{key:"_onClick",value:function(){var r=[];null!==this.mouse_gridPos&&null!==this.nextPieceColour&&(null===this.getGridState(this.mouse_gridPos[0],this.mouse_gridPos[1])&&(this._setGridState(this.mouse_gridPos[0],this.mouse_gridPos[1],{colour:this.nextPieceColour,isGlowing:!1}),this._checkVictory(this.mouse_gridPos[0],this.mouse_gridPos[1],this.nextPieceColour)?(r.push(["incrementWinCount",this.nextPieceColour]),this.nextPieceColour=null,this.status="game-over"):(this.nextPieceColour="white"===this.nextPieceColour?"black":"white",this.status="in-progress",r.push(["nextPlayer",this.nextPieceColour])),r.push(["repaint"])));return r}},{key:"_checkVictory",value:function(r,t,n){var e=this,a=function(a,o){for(var i=0,u=-4;u<=5;u++){var c=e.getGridState(r+u*a,t+u*o);if(null!==c&&c.colour===n)i++;else{if(i>=5){for(u--;i-- >0;)e.getGridState(r+(u-i)*a,t+(u-i)*o).isGlowing=!0;return!0}i=0}}};return a(1,0)||a(0,1)||a(1,1)||a(-1,1)}}]),r}();function cn(r){return function(r){if(Array.isArray(r)){for(var t=0,n=new Array(r.length);t<r.length;t++)n[t]=r[t];return n}}(r)||ln(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function fn(r){return function(r){if(Array.isArray(r))return r}(r)||ln(r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function ln(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}var sn={numLines:15,imageDim:512,imageMargin:32,worldDim:1},dn={cameraAngle:"default",blackPlayer:"Player 1",whitePlayer:"Player 2",wins:{"Player 1":0,"Player 2":0}};function hn(r,t,n){var e={repaint:function(){window.requestAnimationFrame(function(){Gt(r,t,sn)})},nextPlayer:function(r){var t=document.getElementById("message");switch(t.className="",r){case"black":t.innerText=dn.blackPlayer+" - black";break;case"white":t.innerText=dn.whitePlayer+" - white"}},incrementWinCount:function(r){var t;switch(r){case"black":t=dn.blackPlayer;break;case"white":t=dn.whitePlayer;break;default:throw new Error("bad colour")}var n=++dn.wins[t],e=document.getElementById("message");switch(e.className="highlighted",t){case"Player 1":e.innerText="Player 1 wins",e=document.getElementById("player-1-wins");break;case"Player 2":e.innerText="Player 2 wins",e=document.getElementById("player-2-wins");break;default:throw new Error("bad playerid")}e.innerText=1===n?"1 win":n+" wins"}},a=!0,o=!1,i=void 0;try{for(var u,c=n[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var f=fn(u.value),l=f[0],s=f.slice(1);l in e&&e[l].apply(e,cn(s))}}catch(r){o=!0,i=r}finally{try{a||null==c.return||c.return()}finally{if(o)throw i}}}window.addEventListener("load",function(){var r=document.getElementById("glcanvas"),t=r.getContext("webgl"),n=function(){var r=window,t=document,n=t.documentElement,e=t.getElementsByTagName("body")[0],a=r.innerWidth||n.clientWidth||e.clientWidth;return a}();n>r.width&&(r.width=n);var e=$t(r,t,sn),a=new un({cameraAngle:dn.cameraAngle,glCanvas:r,boardConfig:sn});r.addEventListener("mousemove",function(t){var n=a.update("onMouseMove",r,function(r,t){t=t||r.target;var n=function(r,t){var n=(t=t||r.target).getBoundingClientRect();return{x:r.clientX-n.left,y:r.clientY-n.top}}(r,t);return[n.x*t.width/t.clientWidth,n.y*t.height/t.clientHeight]}(t));hn(e,a,n)}),r.addEventListener("mousedown",function(){var r=a.update("onClick");hn(e,a,r)}),document.getElementById("camera-angle-control").value="default",document.getElementById("camera-angle-control").addEventListener("change",function(t){dn.cameraAngle=t.target.value;var n=a.update("setCameraAngle",{cameraAngle:t.target.value,glCanvas:r});hn(e,a,n)}),document.getElementById("start-new-game-button").addEventListener("click",function(){var t=!0;switch(a.getGameStatus()){case"new-game":break;case"in-progress":if(!confirm("Really start new game?"))break;t=!1;case"game-over":if(t){var n=dn.blackPlayer;dn.blackPlayer=dn.whitePlayer,dn.whitePlayer=n}a=new un({cameraAngle:dn.cameraAngle,glCanvas:r,boardConfig:sn}),hn(e,a,[["repaint"],["nextPlayer","black"]])}}),hn(e,a,[["nextPlayer","black"]]),Gt(e,a,sn)},!1)}});
//# sourceMappingURL=app.bundle.js.map